<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Life Duel Prototype – Stats Left, Guide Right</title>
<style>
body{font-family:sans-serif;margin:0;padding:0;display:flex;justify-content:center;align-items:flex-start;margin-top:10px}
#container{display:flex;justify-content:center;align-items:center}
canvas{border:1px solid #555;cursor:pointer}
.sideinfo{width:200px;font-size:0.9rem;line-height:1.4;text-align:left;padding:0 10px}
.sideinfo span.player{font-weight:bold;font-size:1.1rem}
.guide{background:#f9f9f9;border:1px solid #ccc;border-radius:6px;padding:10px;margin-top:10px;font-size:0.85rem}
.guide h3{margin:4px 0}
button{margin-top:8px;padding:6px 12px;font-size:0.9rem;cursor:pointer}
</style>
</head>
<body>
<div id="container">
   <div id="leftInfo" class="sideinfo">
       <div id="stats"></div>
       <button id="restartBtn">Restart Game</button>
   </div>
   <canvas id="board" width="600" height="600"></canvas>
   <div id="guide" class="sideinfo guide"></div>
</div>
<script>
const size=15;
const cellSize=40;
const canvas=document.getElementById('board');
const ctx=canvas.getContext('2d');
let grid, currentPlayer, placements, round, gameOver;
const maxRounds=10;
let hover={x:-1,y:-1};
const leftDiv=document.getElementById('stats');
const restartBtn=document.getElementById('restartBtn');
const guideDiv=document.getElementById('guide');

guideDiv.innerHTML=`<h3>How the World Changes</h3><ul><li><b>Happy squares</b>: If a colored square has <b>2 or 3</b> neighbors, it stays; otherwise it disappears and shows an <span style='color:#000;font-weight:bold'>X</span>.</li><li><b>Baby squares</b>: An empty spot with <b>exactly 3</b> colored neighbors will get a baby, marked by a colored <b>O</b>.</li><li><b>Baby color</b>: more blues ⇒ <span style='color:#1e90ff;font-weight:bold'>Blue</span>; more reds ⇒ <span style='color:#ff4d4d;font-weight:bold'>Red</span>; tie ⇒ <span style='color:#888;font-weight:bold'>Grey</span>.</li><li>Hints update live so you can plan.</li></ul>`;

function initGame(){
 grid=Array.from({length:size},()=>Array(size).fill(0));
 currentPlayer=1;
 placements=0;
 round=0;
 gameOver=false;
 draw();
}
restartBtn.addEventListener('click',initGame);

function computeNextGrid(){
 const next=Array.from({length:size},()=>Array(size).fill(0));
 for(let y=0;y<size;y++){
  for(let x=0;x<size;x++){
   const counts=[0,0,0,0];
   for(let dy=-1;dy<=1;dy++){
    for(let dx=-1;dx<=1;dx++){
     if(dx===0&&dy===0)continue;
     const nx=x+dx, ny=y+dy;
     if(nx>=0&&ny>=0&&nx<size&&ny<size){
       counts[ grid[ny][nx] ]++;
     }
    }
   }
   const live=counts[1]+counts[2]+counts[3];
   const cell=grid[y][x];
   if(cell!==0){
     if(live===2||live===3) next[y][x]=cell;
   } else if(live===3){
     next[y][x]= counts[1]>counts[2]?1: counts[2]>counts[1]?2:3;
   }
  }
 }
 return next;
}

function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 const preview=computeNextGrid();
 let blueCount=0, redCount=0;
 for(let y=0;y<size;y++){
  for(let x=0;x<size;x++){
   const v=grid[y][x];
   if(v){
     ctx.fillStyle=v===1?"#1e90ff":v===2?"#ff4d4d":"#cccccc";
     ctx.fillRect(x*cellSize,y*cellSize,cellSize,cellSize);
     if(v===1)blueCount++; else if(v===2)redCount++;
   }
   ctx.strokeStyle="#888";
   ctx.strokeRect(x*cellSize,y*cellSize,cellSize,cellSize);
   const next=preview[y][x];
   if(v!==0 && next===0){
     ctx.fillStyle="#000";
     ctx.font="bold 24px sans-serif";
     ctx.textAlign="center";ctx.textBaseline="middle";
     ctx.fillText("X", x*cellSize+cellSize/2, y*cellSize+cellSize/2);
   } else if(v===0 && next!==0){
     ctx.fillStyle=next===1?"#1e90ff":next===2?"#ff4d4d":"#888";
     ctx.font="bold 24px sans-serif";
     ctx.textAlign="center";ctx.textBaseline="middle";
     ctx.fillText("O", x*cellSize+cellSize/2, y*cellSize+cellSize/2);
   }
  }
 }
 if(!gameOver && hover.x>=0&&hover.y>=0 && placements<3 && grid[hover.y][hover.x]===0){
   ctx.globalAlpha=0.3;
   ctx.fillStyle=currentPlayer===1?"#1e90ff":"#ff4d4d";
   ctx.fillRect(hover.x*cellSize,hover.y*cellSize,cellSize,cellSize);
   ctx.globalAlpha=1.0;
 }
 updateStats(blueCount,redCount);
}

function updateStats(blue,red){
 const blueMoves=currentPlayer===1?3-placements:0;
 const redMoves=currentPlayer===2?3-placements:0;
 leftDiv.innerHTML=`<b>Round ${round+1}/${maxRounds}</b><br><br><span class='player' style='color:#1e90ff'>Blue</span> – Cells: ${blue}, Moves left: ${blueMoves}<br><span class='player' style='color:#ff4d4d'>Red</span> – Cells: ${red}, Moves left: ${redMoves}<br><br><b>${gameOver?"Game Over":"Current: "+(currentPlayer===1?"Blue":"Red")}</b>${!gameOver?`<br>Place square ${placements+1}/3`:""}`;
}

function eventToCell(e){
 const rect=canvas.getBoundingClientRect();
 return {x:Math.floor((e.clientX-rect.left)/cellSize), y:Math.floor((e.clientY-rect.top)/cellSize)};
}

canvas.addEventListener('mousemove',e=>{
 const {x,y}=eventToCell(e);
 if(x!==hover.x||y!==hover.y){hover={x,y}; draw();}
});
canvas.addEventListener('mouseleave',()=>{hover={x:-1,y:-1}; draw();});

canvas.addEventListener('click',e=>{
 if(gameOver) return;
 const {x,y}=eventToCell(e);
 if(x<0||y<0||x>=size||y>=size) return;
 if(grid[y][x]!==0) return;
 grid[y][x]=currentPlayer;
 placements++;
 if(placements>=3){
   placements=0;
   if(currentPlayer===1){
     currentPlayer=2;
   } else {
     currentPlayer=1;
     grid=computeNextGrid();
     round++;
     if(round>=maxRounds){
       gameOver=true;
     }
   }
 }
 draw();
});

initGame();
</script>
</body>
</html>