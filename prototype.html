<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Life Duel Prototype – Side Guide Edition</title>
<style>
body{font-family:sans-serif;margin:0;padding:0;display:flex;justify-content:center;align-items:flex-start;margin-top:10px}
#container{display:flex;justify-content:center;align-items:center}
canvas{border:1px solid #555;cursor:pointer}
.sideinfo{width:180px;font-size:0.9rem;line-height:1.4;text-align:left;padding:0 8px}
.sideinfo span.player{font-weight:bold;font-size:1.1rem}
.guide{background:#f9f9f9;border:1px solid #ccc;border-radius:6px;padding:8px;margin-top:10px;font-size:0.85rem}
.guide h3{margin:4px 0}
button{margin-top:8px;padding:6px 10px;font-size:0.9rem;cursor:pointer}
</style>
</head>
<body>
<div id="container">
   <div id="leftInfo" class="sideinfo"></div>
   <canvas id="board" width="600" height="600"></canvas>
   <div id="rightInfo" class="sideinfo">
       <div id="stats"></div>
       <button id="restartBtn">Restart Game</button>
       <div id="guide" class="guide"></div>
   </div>
</div>
<script>
const size=15;
const cellSize=40; // 600/15
const canvas=document.getElementById("board");
const ctx=canvas.getContext("2d");
let grid;
let currentPlayer;
let placements;
let round;
const maxRounds=10;
let hover={x:-1,y:-1};
const leftDiv=document.getElementById('leftInfo');
const statsDiv=document.getElementById('stats');
const guideDiv=document.getElementById('guide');
const restartBtn=document.getElementById('restartBtn');

function initGame(){
 grid=Array.from({length:size},()=>Array(size).fill(0));
 currentPlayer=1;
 placements=0;
 round=0;
 draw();
}

restartBtn.addEventListener('click',initGame);

// Guide content
guideDiv.innerHTML=`<h3>How the World Changes</h3><ul><li><b>Happy squares</b>: If a colored square has <b>2 or 3</b> colored neighbors, it stays. Otherwise, it disappears and shows a <span style='color:#000;font-weight:bold'>X</span>.</li><li><b>Baby squares</b>: An empty spot with <b>exactly 3</b> neighbors becomes a baby, marked by a colored <b>O</b>.</li><li><b>Baby color</b>: More blues ⇒ baby is <span style='color:#1e90ff;font-weight:bold'>Blue</span>. More reds ⇒ baby is <span style='color:#ff4d4d;font-weight:bold'>Red</span>. Same ⇒ <span style='color:#888;font-weight:bold'>Grey</span>.</li><li>Hints refresh in real time so you can plan.</li></ul>`;

function computeNextGrid(){
 let next=Array.from({length:size},()=>Array(size).fill(0));
 for(let y=0;y<size;y++){
  for(let x=0;x<size;x++){
   let counts=[0,0,0,0];
   for(let dy=-1;dy<=1;dy++){
    for(let dx=-1;dx<=1;dx++){
     if(dx===0&&dy===0)continue;
     let nx=x+dx, ny=y+dy;
     if(nx>=0&&ny>=0&&nx<size&&ny<size){counts[ grid[ny][nx] ]++;}
    }
   }
   let live=counts[1]+counts[2]+counts[3];
   let cell=grid[y][x];
   if(cell!==0){
     if(live===2||live===3) next[y][x]=cell;
   } else if(live===3){
        if(counts[1]>counts[2]) next[y][x]=1;
        else if(counts[2]>counts[1]) next[y][x]=2;
        else next[y][x]=3;
   }
  }
 }
 return next;
}

function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 const preview=computeNextGrid();
 let blueCount=0, redCount=0;
 for(let y=0;y<size;y++){
  for(let x=0;x<size;x++){
   let v=grid[y][x];
   if(v){
     ctx.fillStyle=v===1?"#1e90ff":v===2?"#ff4d4d":"#cccccc";
     ctx.fillRect(x*cellSize,y*cellSize,cellSize,cellSize);
     if(v===1)blueCount++; else if(v===2)redCount++;
   }
   ctx.strokeStyle="#888";
   ctx.strokeRect(x*cellSize,y*cellSize,cellSize,cellSize);
   let next=preview[y][x];
   if(v!==0 && next===0){
       ctx.fillStyle="#000";
       ctx.font="bold 24px sans-serif";
       ctx.textAlign="center";ctx.textBaseline="middle";
       ctx.fillText("X", x*cellSize+cellSize/2, y*cellSize+cellSize/2);
   } else if(v===0 && next!==0){
       ctx.fillStyle=next===1?"#1e90ff":next===2?"#ff4d4d":"#888";
       ctx.font="bold 24px sans-serif";
       ctx.textAlign="center";ctx.textBaseline="middle";
       ctx.fillText("O", x*cellSize+cellSize/2, y*cellSize+cellSize/2);
   }
  }
 }
 if(hover.x>=0&&hover.y>=0&&round<maxRounds&&placements<3 && grid[hover.y][hover.x]===0){
   ctx.globalAlpha=0.3;
   ctx.fillStyle=currentPlayer===1?"#1e90ff":"#ff4d4d";
   ctx.fillRect(hover.x*cellSize,hover.y*cellSize,cellSize,cellSize);
   ctx.globalAlpha=1.0;
 }
 updateSideInfo(blueCount,redCount);
}

function updateSideInfo(blueCount,redCount){
 let blueMoves=currentPlayer===1?3-placements:0;
 let redMoves=currentPlayer===2?3-placements:0;
 leftDiv.innerHTML=`<span class='player' style='color:#1e90ff'>Blue</span><br>Cells: ${blueCount}<br>Moves left: ${blueMoves}`;
 statsDiv.innerHTML=`Round ${round+1}/${maxRounds}<br><span class='player' style='color:#ff4d4d'>Red</span><br>Cells: ${redCount}<br>Moves left: ${redMoves}<br><br><b>${currentPlayer===1?'Blue':'Red'}'s turn</b><br>Place square ${placements+1}/3`;
}

function endGame(){
 draw(); // counts update is inside draw
 statsDiv.innerHTML+="<br><br><b>Game Over!</b>";
}

canvas.addEventListener("click",e=>{
 if(round>=maxRounds)return;
 const {x,y}=eventToCell(e);
 if(x<0||x>=size||y<0||y>=size)return;
 if(grid[y][x]!==0)return;
 grid[y][x]=currentPlayer;
 placements++;
 if(placements>=3){
  placements=0;
  if(currentPlayer===1){
    currentPlayer=2;
  } else {
    currentPlayer=1;
    grid=computeNextGrid();
    round++;
    if(round>=maxRounds){endGame();return;}
  }
 }
 draw();
});

canvas.addEventListener("mousemove",e=>{
 const {x,y}=eventToCell(e);
 if(x!==hover.x||y!==hover.y){hover={x,y};draw();}
});
canvas.addEventListener("mouseleave",()=>{hover={x:-1,y:-1};draw();});

function eventToCell(e){
 const rect=canvas.getBoundingClientRect();
 return {x:Math.floor((e.clientX-rect.left)/cellSize),y:Math.floor((e.clientY-rect.top)/cellSize)};
}

initGame();
</script>
</body>
</html>
